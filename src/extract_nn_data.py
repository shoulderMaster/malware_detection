#!/usr/bin/python3

import pandas as pd
import functools

def main() :
    malware_list = [
            "./similarity_vectors_malware_string.csv",
            "./similarity_vectors_malware_api.csv",
            "./similarity_vectors_malware_dll.csv",
        ]
    benign_list = [
            "./similarity_vectors_benign_string.csv",
            "./similarity_vectors_benign_api.csv",
            "./similarity_vectors_benign_dll.csv"
        ]
    malware_df_list = [load_csv(target_name) for target_name in malware_list]
    benign_df_list = [load_csv(target_name) for target_name in benign_list]
    for i in malware_df_list :
        print(len(i.columns))
    merged_df = simple_merge_df(malware_df_list)
    print(len(merged_df.columns))


def load_csv(file_name) :
    if "malware" in file_name :
        label_malware = 1 #this means the corresponding file is malicious set
        label_benign = 0
    else :
        label_malware = 0
        label_benign = 1
    column_prefix = file_name.split("_")[-1].split(".")[0] + "_%d"
    df = pd.read_csv(file_name).set_index("file_name")
    df.columns = [column_prefix % i for i in range(len(df.columns))]
    df["label_malware"] = label_malware
    df["label_benign"] = label_benign
    return df

def simple_merge_df(df_list) :
    label_list = ["label_malware", "label_benign"]
    label_df = df_list[0][label_list]
    df_list = [df.drop(label_list, axis=1) for df in df_list]
    df_list.append(label_df)
    merged_df = functools.reduce(lambda x, y : x.join(y), df_list)
    return merged_df


main()
